# 2025-06-17 - Database Connection Pool(데이터베이스 커넥션 풀)

## Database 생애 주기

- DB 드라이버 사용해 DB 연결
- 데이터 읽기/쓰기를 위한 TCP 소켓 열기
- 소켓을 통한 데이터 읽기/쓰기
- 연결 종료
- 소켓 닫기

## Database Connection Pool이란

- `데이터베이스 커넥션 풀(Database Connection Pool)`은 애플리케이션이 데이터베이스에 접속할 때 필요한 `연결(Connection)`을 미리 만들어 풀(Pool)에 보관해 두었다가, 필요할 때 빌려서 사용하고 끝나면 다시 반환받아 재활용하는 기술
- 웹 애플리케이션이나 엔터프라이즈 애플리케이션과 같은 여러 사용자가 동시에 데이터베이스에 접근하는 환경에서 성능과 효율성 향상

### 사용 이유

1. 성능 향상
   - 커넥션 생성 비용 절감: DB 커넥션은 비용이 매우 크고 매번 새로운 요청마다 큰 오버헤드 발생. 이를 미리 만든 커넥션 풀을 재활용하며 비용 감소
   - 응답 시간 단축: 커넥션 생성 시간이 줄어들어 사용자 요청에 대한 시간 단축
2. 자원 효율성 증대
   - 커넥션 수 제한: 풀 내의 커넥션 수를 제한하여 서버에 과도한 부하가 걸리는 것을 방지
   - 유휴 커넥션 관리: 사용되지 않는 유휴 커넥션을 일정 시간 후 자동으로 정리해 불필요한 자원 낭비 줄임
3. 안정성 및 신뢰성 향상
   - DoS 공격 방어: 대량의 커넥션 요청(서비스 거부 공격, DOS)이 들어와도 풀에 설정된 최대 커넥션 수 이상으로 연결 허용하지 않아 서버 보호
   - 복원력: DB 연결이 일시적으로 끊어지거나 문제 발생 시, 커넥션 풀이 내부적으로 커넥션을 재검증하거나 재연결시도해 복원력 높임
4. 관리 용이성
   - 커넥션 열고 닫는 로직 직접 구현 필요 없음
   - 커넥션 수를 동적 조절하여 시스템 부하 대처 가능
   - **Spring Boot**에서는 `HikariCP`를 기본 제공하며, `application.yml`을 통해 커넥션 풀 관리

### DB Connection Pool 없을 시 문제점

- 앞서의 **사용 이유** 항목의 반대로 생각하면 됨

### 커넥션 풀 클수록 좋은가?

- 커넥션의 주체는 스레드(Thread)이기 때문에 연결하여 생각
  - 스레드 풀 사이즈보다 큰 경우 -> 스레드를 사용하지 못해 리소스 낭비
  - 스레드 풀 사이즈보다 작은 경우 -> 커넥션 반환을 기다려 작업 지연
- 너무 큰 경우에는 메모리와 CPU를 너무 많이 사용해 성능 저하

## 요약

> Database Connection Pool은 DB 커넥션을 미리 생성해 재활용하여 커넥션 생성 비용 절감과 애플리케이션의 성능과 자원 효율성 크게 향상
>
> 커넥션 풀이 없는 경우, 잦은 커넥션 생성/해제 오버헤드로 인한 성능 저하, DB 서버의 자원 고갈 및 다운, 애플리케이션 안정성 저하
