# 2025-06-12 - TCP 3-way handshake

## TCP 3-way handshake 란

- **TCP**는 신뢰할 수 있는 데이터 통신을 가능하게 하는 연결 지향형 프로토콜
- 데이터를 주고받기 전 연결을 진행하는데, 이를 **3-way handshake**라고 함

## 과정

### 1단계 (SYN) - 연결 요청

- 주체: 클라이언트
- 동작: 클라이언트가 서버에 연결을 요청하는 메시지인 `SYN` 패킷 전송
- 포함 정보: 클라이언트가 생성한 **초기 시퀀스 번호(ISN)** `X`를 포함, 이 번호를 이후 데이터 전송시 데이터 순서 보장에 사용
- 목적: 서버에 클라이언트 연결 요청 알림, 앞선 `X`를 전송

### 2단계 (SYN-ACK) - 요청 수락 및 응답

- 주체: 서버
- 동작:
  - 서버가 클라이언트로부터 `SYN` 패킷 수신
  - 연결 요청을 수락한다는 의미의 `ACK` 패킷과 자신도 클라이언트에 연결 요청하는 `SYN` 패킷인 `SYN-ACK` 패킷 전송
- 포함 정보:
  - `ACK N`: 클라이언트의 `ISN X`에 1을 더한 값인 `X+1`을 포함하여 준비 되었음을 알림
  - `ISN Y`: 서버가 생성한 `ISN Y`를 포함하여, 자신도 `Y`부터 데이터 보냄을 알림
- 목적: 클라이언트의 요청 `SYN`을 수락하고, `ACK (X+1)`와 자신의 `ISN Y`를 전달하여 통신 준비 알림

### 3단계 (ACK) - 연결 완료

- 주체: 클라이언트
- 동작:
  - 클라이언트가 서버로부터 `SYN-ACK` 패킷 수신
  - 이에 대한 응답으로 `ACK` 패킷 전송
- 포함정보:
  - `ACK N`: 서버의 `ISN Y`에 1을 더한 `Y+1`을 포함하여 다음 데이터 `(Y+1)` 부터 받을 준비가 되었음을 알림
- 목적: 서버의 `SYN-ACK` 요청을 수락하고 통신 준비를 알림

## 필요성

- **신뢰성**: 양방향 통신에 앞서 클라이언트와 서버가 서로의 존재를 확인하고, 통신 준비를 알림
- **ISN 동기화**: 데이터 시작 번호`(ISN)`를 동기화하여 데이터 패킷 유실이나 중복이 발생해도 순서 보장. 이는 핵심 기능인 **흐름 제어**와 **혼잡 제어**의 기반
- **논리적 연결 생성**: 실제 데이터 전송 시작 전, 양단의 논리적 통신 경로 확립을 의미

## 요약

> TCP 3-way handshake는 클라이언트와 서버가 신뢰성 있는 TCP 통신 연결을 수립하기 위한 3단계 과정입니다.
>
> 1. SYN: 클라이언트가 `ISN X`를 포함한 연결 요청
> 2. SYN-ACK: 서버가 클라이언트의 `SYN`을 `ACK (X+1)`로 확인하고, 자신의 `ISN Y`를 담아 연결 수락 요청
> 3. ACK: 클라이언트가 서버의 `SYN-ACK`를 `ACK(Y+1)`로 확인하며 연결 설정 완료
> 이 과정을 통해 양방향 통신 준비와 시퀀스 번호 동기화가 이루어져 데이터 전송 신뢰성 확보를 달성합니다.
