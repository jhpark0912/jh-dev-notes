# 2025-05-21 - 엔티티 매니저란?

## 오늘 주제

JPA에서 사용하는 `EntityManager` 란 무엇인지, 그리고 어떤식으로 활용되는지에 대해

## EntityManager란

JPA에서 제공하는 인터페이스이며, `영속성 컨텍스트`를 통해 엔티티의 생명주기를 관리하는 도구

### 핵심 기능

| 메서드 | 설명 |
| ----- | ----- |
| `persist()` | 새로운 엔티티 영속 상태 저장(Insert)  |
| `find()` | ID 기반 조회(캐시 활용) |
| `remove()` | 엔티티 삭제 (Delete) |
| `merge()` | 준영속 상태의 엔티티를 갱신/ 병합 |
| `flush()` | 영속성 컨텍스트에 있는 변경사항을 DB에 반영 |
| `clear()` | 영속성 컨텍스트 초기화 (모든 엔티티 detach) |
| `detach()` | 특정 엔티티 영속성 컨텍스트에서 제거 |
| `contains()` | 해당 엔티티가 영속상태인지 확인|

### 엔티티 생명 주기

```java
Member meber = new Member("유저");
```

위의 코드를 통해 유저가 생성은 되었지만 영속성 컨텍스트와 연관 되지는 않은 상태이며 단순히 메모리상에만 존재하는 상태이다.

```java
em.persist(member);
em.merge(oldMember);
em.find(Member.class, 1L);
```

해당 엔티티를 영속성 컨텍스트에서 관리가 가능하도록 `persist`를 통해서 영속상태로 만들어준다. 이후에 변경되는 것은 추후 자동으로 데이터 베이스에 반영된다.

```java
em.detach(member);
em.clear();
em.close();
```

`detach`를 통해서 준영속상태로 만들어주고 이는 영속성 컨텍스트와 분리가 되었음을 의미하며, 더이상 변경되는 사항에 대해 반영되지 않는 것을 의미한다. 그리고 컨택스트 종료, 트랜잭션 종료를 통해서 해당 변경이 가능하다.

```java
em.remove(member);
```

삭제 상태는 영속성 컨텍스트에서 제거할 뿐만아니라 엔티티 자체를 DB에서 삭제하는 동작이 된다.

## 추가 공부할 사항

- 영속성 컨텍스트에 대해서 좀더 이해하고 공부를 하도록한다.
- `Dirty Checking`의 개념을 더 잘 이해할 수 있도록한다.
