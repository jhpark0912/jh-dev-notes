# 2025-07-25 - CAP 정리

## CAP 정리

- `CAP 정리`는 분산 컴퓨터 시스템이 세 가지 보증 중 **동시에 두 가지만 만족할 수 있다**는 것을 명시하는 이론
- 네트워크 분할 상황에서는 일관성(Consistency)과 가용성(Availability) 중 하나를 포기해야 함
- 세가지 속성
   1. C - Consistency(일관성)
   2. A - Availability(가용성)
   3. P - Partition Tolerance(파티션 내결함성)

### C - Consistency(일관성)

- 개념
  - 모든 클아이언트가 동시에 동일한 데이터를 보는 것
  - 시스템 내의 모든 노드(서버)가 동일한 시점에 동일한 데이터를 가지고 있음을 보장
  - 데이터가 업데이트되면, 모든 후속 읽기 작업은 해당 업데이트된 최신 데이터 반환

### A - Availability(가용성)

- 개념
  - 모든 요청이 성공 또는 실패 응답을 받으며, 시스템이 항상 작동 가능한 상태를 의미
  - 사용자가 시스템에 요청 보냈을 때, 항상 유효한 응답을 받을 수 있어야 함
  - 일부 노드 장애 발생하더라도 서비스 중단되지 않고 계속 요청 처리할 수 있어야 함

### P - Partition Tolerance(파티션 내결함성)

- 개념
  - 시스템의 일부가 다른 부분과 통신할 수 없는 네트워크 분할(Partition) 상황에서도 시스템이 계속 작동한다는 것을 의미
  - 네트워크 분할은 서버 간의 통신이 단절되는 상황
  - 분산 시스템은 이러한 네트워크 분할 상황을 반드시 고려

## 두가지만 가능한 이유

- 네트워크 분할(P)이 발생한 경우, 일관성 혹은 가용성 중 하나를 선택
- 즉, 기본 전제인 네트워크 분할은 언제든 발생할 수 있기 때문에, 둘중 하나를 선택해야함

1. CP (Consistency + Partition Tolerance)- 일관성 유지, 가용성 희생
   - 전략: 네트워크 분할 발생 시, 시스템은 데이터 일관성을 보장하기 위해 일부 요청에 대한 응답을 지연시키거나 오류 반환
   - 동작: 분할된 노드가 서로 통신할 수 없어 최신 데이터를 동기화할 수 없을 때, 시스템은 쓰기, 읽기 허용하지 않고 대기하거나 오류 반환
   - 단점: 네트워크 분할 시 서비스가 일시적으로 중단되거나 응답을 받지 못할 수 있음
2. AP (Availability + Partition Tolerance) - 가용성 유지, 일관성 희생
   - 전략: 네트워크 분할 발생하더라도 요청에 대한 응답을 제공하지만, 최신 데이터가 아닐 수 있음
   - 동작: 분할된 노드들이 통신할 수 없어도 독립적으로 요청 처리 반환. 단, 데이터 불일치 발생
   - 단점: 네트워크 분할 기간 동안 데이터 불일치(Stale Data) 발생
3. CA (Consistency + Availability) - 파티션 내결함성 희생 
   - 전략: 네트워크 분할이 절대 발생하지 않는다고 가정하거나, 분할 발생하면 시스템 멈춤
   - P를 포기한다는 것은 분산 시스템에서는 불가능 한것이므로 없는 조건

## 요약

> CAP 정리는 분산 시스템이 일관성(Consistency), 가용성(Availability), 파티션 내결함성(Partition Tolerance) 세 가지 중 오직 두가지만 동시에 만족
>
> - C(일관성): 모든 노드가 항상 최신/동일한 데이터를 보유
> - A(가용성): 모든 요청이 항상 유효한 응답을 받음
> - P(파티션 내결함성): 네트워크 분할 상황에서도 시스템이 계속 작동
> 이 중 CP 혹은 AP를 선택해 적용
