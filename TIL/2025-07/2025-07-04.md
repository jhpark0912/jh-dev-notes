# 2025-07-04 - DB Replication

## DB Replication 이란?

- **DB Replication**은 말 그대로 데이터베이스의 데이터를 다른 데이터 베이스 서버에 복사하고 동기화하는 기술
- 원본 데이터베이스 서버의 데이터와 동일한 사본을 여러 대의 다른 서버에 유지
- 이를 통해 가용성과 성능을 향상

## 사용 목적

1. 고가용성 및 장애 복구
   - DB 서버가 한대인 경우 장애 발생 시, 전체 서비스 중단
   - 하지만, 복제된 서버를 통해서 복제 서버가 잠시라도 그 역할을 대체하여 안정성 높임
2. 성능 향상 및 부하 분산
   - 쓰기 작업은 원본에서 처리하고, 읽기 작업은 복제된 서버에서 처리하여 서버의 부하를 줄여 성능 향상 처리하며 이를 읽기 확장이라 함
3. 데이터 백업 및 분석
   - 원본 서버에 부하를 주지 않고 백업을 수행하거나 데이터 분석 및 리포팅 가능

## 기본 동작 방식

### **Master-Slave** 구조

- Master(or Primary)
  - 데이터의 원본
  - 모든 쓰기(Write) 작업 처리
  - 쓰기 작업 발생시 변경 로그(Binary Log 등)를 기록
- Slave(or Replica)
  - Master의 복제본
  - Master의 변경로그를 지속적으로 받아 자신의 DB에 반영
  - 주로 읽기(Read) 작업을 처리하여 Master의 부하 분산

### 동기화 방식

1. 비동기 복제
   - Master에 데이터 변경 발생 시, Slave로 로그보내지만 Slave는 반영여부 기다리지 않고 다음 작업 진행
   - Master의 쓰기성능이 매우 빠르지만, 장애 발생시 Slave에서 데이터 손실이 발생
   - 가장 흔하게 사용 되며, MySQL, Maria DB의 기본 복제 방식
2. 동기 복제
   - Master에서 데이터 변경이 발생하면, Slave는 성공적 반영을 확인한 후 Master가 다음 작업 진행
   - Master의 쓰기 성능이 Slave 반영 여부에 따라 느려질 수 있지만, 데이터 일관성이 보장됨
   - 고가용성이 중요한 금융 시스템 같은 곳에서 사용

### 복제 과정(MySQL 기준)

- `Binary log`를 저장하는 방식을 통해 동기화 처리되며, `Row`, `Statement`, `Mixed` 세가지 방식을 제공
- `Row`
  - DB의 각 행별로 변경된 내용을 저장하여 정확히 기록
  - 일관성이 매우 높지만 모든 행의 변경 사항을 저장하기 때문에 `Binary log` 파일 크기가 급격히 증가해 저장 공간 부담
- `Statement`
  - 데이터 변경을 일으킨 SQL문 자체를 기록
  - 로그 파일이 상대적으로 작게 유지되지만, 비확정적 SQL 쿼리가 실행되는 경우 데이터 불일치가 발생할 수 있음(ex. `SELECT NOW()`)
- `Mixed`
  - 위의 두가지 방식을 혼합하여 처리
  - 비확정적 SQL이 아닌 경우에는 `statement`, 비확정적 SQL 실행 시에는 `Row`형태로 저장해 일관성 유지
  - 단, 구현의 복잡도가 상승

## 요약

> DB Replication은 데이터 베이스의 데이터를 다른 서버에 복사해 동기화 하는 기술
> 주요 목적은 원본 장애 시 서비스 중단을 막는 고가용성과, 읽기 작업을 분산하여 성능 향상
> 주로 Master-Slave 구성을 활용하며 Master는 쓰기를, Slave는 읽기를 담당하고 비동기 복제가 주로 사용됨
> 복제 방식으로는 MySQL 기준으로 `Binary log`를 저장하며, `Row`, `Statement`, `Mixed` 방식이 있음
